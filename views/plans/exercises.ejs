<% layout('layouts/boilerplate') %>

<div class="container my-4">
    <!-- Header -->
    <div class="text-center mb-4">
        <h1 class="display-5 fw-bold text-primary">ğŸ“š Exercise Library</h1>
        <p class="lead text-muted">Discover detailed instructions for hundreds of exercises</p>
    </div>

    <!-- Filters -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="GET" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Muscle Group</label>
                    <select name="muscle" class="form-select">
                        <option value="">All Muscles</option>
                        <% muscleGroups.forEach(muscle => { %>
                            <option value="<%= muscle %>" <%= filters.muscle === muscle ? 'selected' : '' %>>
                                <%= muscle.charAt(0).toUpperCase() + muscle.slice(1) %>
                            </option>
                        <% }) %>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Equipment</label>
                    <select name="equipment" class="form-select">
                        <option value="">All Equipment</option>
                        <% equipmentTypes.forEach(equipment => { %>
                            <option value="<%= equipment %>" <%= filters.equipment === equipment ? 'selected' : '' %>>
                                <%= equipment.replace('_', ' ').charAt(0).toUpperCase() + equipment.replace('_', ' ').slice(1) %>
                            </option>
                        <% }) %>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Difficulty</label>
                    <select name="difficulty" class="form-select">
                        <option value="">All Levels</option>
                        <option value="beginner" <%= filters.difficulty === 'beginner' ? 'selected' : '' %>>Beginner</option>
                        <option value="intermediate" <%= filters.difficulty === 'intermediate' ? 'selected' : '' %>>Intermediate</option>
                        <option value="advanced" <%= filters.difficulty === 'advanced' ? 'selected' : '' %>>Advanced</option>
                    </select>
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary me-2">Filter Exercises</button>
                    <a href="/plans/exercises/browse" class="btn btn-outline-secondary">Clear Filters</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Quick Muscle Group Navigation -->
    <div class="card mb-4 bg-light">
        <div class="card-body">
            <h6 class="mb-3">Quick Filter by Muscle Group:</h6>
            <div class="d-flex flex-wrap gap-2">
                <a href="?muscle=chest" class="btn btn-sm btn-outline-primary">ğŸ’ª Chest</a>
                <a href="?muscle=back" class="btn btn-sm btn-outline-primary">ğŸ”™ Back</a>
                <a href="?muscle=shoulders" class="btn btn-sm btn-outline-primary">ğŸ‘† Shoulders</a>
                <a href="?muscle=biceps" class="btn btn-sm btn-outline-primary">ğŸ’ª Biceps</a>
                <a href="?muscle=triceps" class="btn btn-sm btn-outline-primary">ğŸ’ª Triceps</a>
                <a href="?muscle=legs" class="btn btn-sm btn-outline-primary">ğŸ¦µ Legs</a>
                <a href="?muscle=core" class="btn btn-sm btn-outline-primary">ğŸ¯ Core</a>
                <a href="?equipment=bodyweight" class="btn btn-sm btn-outline-success">ğŸ¤¸ Bodyweight</a>
            </div>
        </div>
    </div>

    <!-- Alert Messages -->
    <%- include('../partials/alerts') %>

    <!-- Exercise Grid -->
    <div class="row">
        <% if (exercises.length === 0) { %>
            <div class="col-12">
                <div class="text-center py-5">
                    <h4 class="text-muted">No exercises found</h4>
                    <p class="text-muted">Try adjusting your filters to see more exercises</p>
                    <a href="/plans/exercises/browse" class="btn btn-primary">Show All Exercises</a>
                </div>
            </div>
        <% } else { %>
            <% exercises.forEach(exercise => { %>
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card h-100 shadow-sm">
                        <% if (exercise.imageUrl) { %>
                            <img src="<%= exercise.imageUrl %>" class="card-img-top" alt="<%= exercise.name %>" style="height: 200px; object-fit: cover;">
                        <% } else { %>
                            <div class="card-img-top d-flex align-items-center justify-content-center bg-light" style="height: 200px;">
                                <div class="text-center">
                                    <div style="font-size: 3rem; opacity: 0.5;">
                                        <% if (exercise.muscleGroups.includes('chest')) { %>ğŸ’ª
                                        <% } else if (exercise.muscleGroups.includes('back')) { %>ğŸ”™
                                        <% } else if (exercise.muscleGroups.includes('legs')) { %>ğŸ¦µ
                                        <% } else if (exercise.muscleGroups.includes('core')) { %>ğŸ¯
                                        <% } else if (exercise.muscleGroups.includes('shoulders')) { %>ğŸ‘†
                                        <% } else { %>ğŸ‹ï¸<% } %>
                                    </div>
                                </div>
                            </div>
                        <% } %>
                        
                        <div class="card-body d-flex flex-column">
                            <div class="mb-2">
                                <span class="badge bg-<%= exercise.difficulty === 'beginner' ? 'success' : exercise.difficulty === 'intermediate' ? 'warning' : 'danger' %> me-2">
                                    <%= exercise.difficulty.charAt(0).toUpperCase() + exercise.difficulty.slice(1) %>
                                </span>
                                <% if (exercise.equipment !== 'bodyweight') { %>
                                    <span class="badge bg-secondary">
                                        <%= exercise.equipment.replace('_', ' ').charAt(0).toUpperCase() + exercise.equipment.replace('_', ' ').slice(1) %>
                                    </span>
                                <% } else { %>
                                    <span class="badge bg-success">Bodyweight</span>
                                <% } %>
                            </div>
                            
                            <h5 class="card-title"><%= exercise.name %></h5>
                            <p class="card-text text-muted flex-grow-1">
                                <%= exercise.description.length > 100 ? exercise.description.substring(0, 100) + '...' : exercise.description %>
                            </p>
                            
                            <div class="mb-3">
                                <small class="text-muted">
                                    <strong>Targets:</strong> 
                                    <% exercise.muscleGroups.slice(0, 3).forEach((muscle, index) => { %>
                                        <%= muscle.charAt(0).toUpperCase() + muscle.slice(1) %><%= index < Math.min(exercise.muscleGroups.length, 3) - 1 ? ', ' : '' %>
                                    <% }) %>
                                    <% if (exercise.muscleGroups.length > 3) { %>
                                        <span class="text-primary">+<%= exercise.muscleGroups.length - 3 %> more</span>
                                    <% } %>
                                </small>
                            </div>
                        </div>
                        
                        <div class="card-footer bg-transparent">
                            <a href="/plans/exercise/<%= exercise._id %>" class="btn btn-primary w-100">
                                View Details & Instructions
                            </a>
                        </div>
                    </div>
                </div>
            <% }) %>
        <% } %>
    </div>

    <!-- Pagination/Load More (if needed) -->
    <% if (exercises.length >= 100) { %>
        <div class="text-center mt-4">
            <p class="text-muted">Showing first 100 exercises. Use filters to narrow down results.</p>
        </div>
    <% } %>

    <!-- Back to Plans -->
    <div class="text-center mt-4">
        <a href="/plans" class="btn btn-outline-primary btn-lg">
            â† Back to Workout Plans
        </a>
    </div>
</div>